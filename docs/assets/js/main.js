"use strict";const input=document.querySelector(".js-inputSearch"),btnSearch=document.querySelector(".js-btnSearch"),btnReset=document.querySelector(".js-btnReset"),divContainer=document.querySelector(".js-divContainer"),containerFav=document.querySelector(".js-containerFavs"),linkBaseApi="https://api.jikan.moe/v3/search/anime?q=";let dataApi=[],favs=[];function getApi(e){fetch(e).then(e=>e.json()).then(e=>{dataApi=e.results,console.log(dataApi);for(const e of dataApi)renderImageSerie(e);seriesListener()})}function renderImageSerie(e){"https://cdn.myanimelist.net/images/qm_50.gif?s=e1ff92a46db617cb83bfc1e205aff620"===e.image_url&&(e.image_url="https://via.placeholder.com/210x295/5d58d7/f696af/?text=TV"),favs.find(t=>t.mal_id===e.mal_id)?divContainer.innerHTML+=`<div class="js-divSerieFavorite" data-id="${e.mal_id}"><p>${e.title}</p><img class= "image-search" src="${e.image_url}" alt="${e.title}"></img></div>`:!0===e.airing?divContainer.innerHTML+=`<div class="divSerie" data-id="${e.mal_id}"><p>${e.title}</p><a href="${e.url}">Más detalles</a><img class= "image-search" src="${e.image_url}" alt="${e.title}"></img></div>`:divContainer.innerHTML+=`<div class="divSerie" data-id="${e.mal_id}"><p>${e.title}</p><p class="serie-bad">La serie no se está transmitiendo</p><img class= "image-search" src="${e.image_url}" alt="${e.title}"></img></div>`}function handleSearchElement(e){e.preventDefault(),divContainer.innerHTML="";getApi(linkBaseApi+input.value)}function handleReset(e){e.preventDefault(),input.value="",divContainer.innerHTML=""}function seriesListener(){const e=document.querySelectorAll(".divSerie");for(const t of e)t.addEventListener("click",addFavorite)}function getHtmlFavoriteCode(e){let t="";return"https://cdn.myanimelist.net/images/qm_50.gif?s=e1ff92a46db617cb83bfc1e205aff620"===e.image_url&&(e.image_url="https://via.placeholder.com/210x295/5d58d7/f696af/?text=TV"),t+=`<ul class="ulFavs" data-id="${e.mal_id}">`,t+=`<img class="image-favs" src="${e.image_url}" alt="${e.title}"></img>`,t+=`<li class= "titleFavs"> ${e.title} </li>`,t+='<span class="removeFavs">X</span>',t+="</ul>",t}function paintFavorites(e){containerFav.innerHTML="";for(const e of favs)containerFav.innerHTML+=getHtmlFavoriteCode(e);const t=document.querySelectorAll(".ulFavs");for(const e of t)e.addEventListener("click",handleFavorite);const a=document.querySelectorAll(".removeFavs");for(const e of a)e.addEventListener("click",handleRemoveFav)}function handleFavorite(e){const t=favs.find(t=>t.mal_id===parseInt(e.currentTarget.dataset.id));console.log(t.title)}function handleRemoveFav(e){let t=[];const a=e.currentTarget.parentNode.dataset.id;for(const e of favs)parseInt(a)!==parseInt(e.mal_id)&&t.push(e);favs=t,paintFavorites(),divContainer.innerHTML="";for(const e of dataApi)renderImageSerie(e);seriesListener(),setInLocalStorage()}function addFavorite(e){const t=e.currentTarget.dataset.id;favs.find(e=>e.mal_id===parseInt(t))||(e.currentTarget.classList.remove("divSerie"),e.currentTarget.classList.add("js-divSerieFavorite"),favs.push(dataApi.find(e=>e.mal_id===parseInt(t))),console.log(favs),paintFavorites(),setInLocalStorage())}function getFromLocalStorage(){const e=localStorage.getItem("favs");e&&(favs=JSON.parse(e),paintFavorites())}function setInLocalStorage(){const e=JSON.stringify(favs);localStorage.setItem("favs",e)}getFromLocalStorage(),btnSearch.addEventListener("click",handleSearchElement),btnReset.addEventListener("click",handleReset),paintFavorites();